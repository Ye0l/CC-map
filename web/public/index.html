<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CC-Map Bot Admin</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background-color: #f4f4f9; }
        h1 { color: #333; }
        .container { max-width: 1400px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .tabs { display: flex; border-bottom: 2px solid #ddd; margin-bottom: 20px; }
        .tab { padding: 10px 20px; cursor: pointer; font-weight: bold; color: #666; }
        .tab.active { color: #007bff; border-bottom: 2px solid #007bff; }
        .content { display: none; }
        .content.active { display: block; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
        th { background-color: #f8f9fa; }
        
        input, textarea { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        button.delete { background-color: #dc3545; }
        button.delete:hover { background-color: #bd2130; }

        .form-group { background: #f9f9f9; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ¤– CC-Map Bot ê´€ë¦¬ì</h1>

    <div class="tabs">
        <div class="tab active" onclick="showTab('tips')">íŒ ê´€ë¦¬</div>
        <div class="tab" onclick="showTab('maps')">ë§µ ê´€ë¦¬</div>
        <div class="tab" onclick="showTab('stats')">ê²°íˆ¬ ì „ì </div>
    </div>

    <!-- íŒ ê´€ë¦¬ -->
    <div id="tips" class="content active">
        <div class="form-group">
            <h3>íŒ ì¶”ê°€ / ìˆ˜ì •</h3>
            <input type="hidden" id="tipId">
            <input type="text" id="tipCategory" placeholder="ì¹´í…Œê³ ë¦¬ (ì˜ˆ: ì§ì—…, ë§µ)">
            <input type="text" id="tipKeyword" placeholder="í‚¤ì›Œë“œ (ì˜ˆ: ë‚˜ì´íŠ¸, íŒ”ë¼ì´ìŠ¤íŠ¸ë¼)">
            <textarea id="tipContent" rows="4" placeholder="íŒ ë‚´ìš©"></textarea>
            <div style="display: flex; gap: 10px;">
                <button onclick="saveTip()" id="saveBtn">ì €ì¥í•˜ê¸°</button>
                <button onclick="resetForm()" style="background-color: #6c757d;">ì´ˆê¸°í™”</button>
            </div>
        </div>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>ì¹´í…Œê³ ë¦¬</th>
                    <th>í‚¤ì›Œë“œ</th>
                    <th>ë‚´ìš©</th>
                    <th>ì‘ì—…</th>
                </tr>
            </thead>
            <tbody id="tipList"></tbody>
        </table>
    </div>

    <!-- ë§µ ê´€ë¦¬ -->
    <div id="maps" class="content">
        <h3>ë§µ ë¦¬ìŠ¤íŠ¸</h3>
        <table>
            <thead>
                <tr>
                    <th>ìˆœì„œ</th>
                    <th>ì´ë¦„</th>
                    <th>ì´ëª¨ì§€</th>
                </tr>
            </thead>
            <tbody id="mapList"></tbody>
        </table>
    </div>

    <!-- ì „ì  ì¡°íšŒ -->
    <div id="stats" class="content">
        <h3>ê²°íˆ¬ ì „ì  ë­í‚¹ (Top 100)</h3>
        <table>
            <thead>
                <tr>
                    <th>User ID</th>
                    <th>ìŠ¹</th>
                    <th>íŒ¨</th>
                    <th>ë¬´</th>
                </tr>
            </thead>
            <tbody id="statsList"></tbody>
        </table>
    </div>
</div>

<script>
    const API_URL = '/api';

    function showTab(tabId) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
        document.getElementById(tabId).classList.add('active');
        
        if(tabId === 'tips') loadTips();
        if(tabId === 'maps') loadMaps();
        if(tabId === 'stats') loadStats();
    }

    let tipsData = [];

    async function loadTips() {
        const res = await fetch(`${API_URL}/tips`);
        tipsData = await res.json();
        const tbody = document.getElementById('tipList');
        tbody.innerHTML = tipsData.map(tip => `
            <tr>
                <td>${tip.id}</td>
                <td>${tip.category || '-'}</td>
                <td>${tip.keyword}</td>
                <td style="white-space: pre-wrap;">${tip.content}</td>
                <td>
                    <button onclick="editTip(${tip.id})" style="background-color: #28a745; margin-right: 5px;">ìˆ˜ì •</button>
                    <button class="delete" onclick="deleteTip(${tip.id})">ì‚­ì œ</button>
                </td>
            </tr>
        `).join('');
    }

    function editTip(id) {
        const tip = tipsData.find(t => t.id === id);
        if(!tip) return;
        
        document.getElementById('tipId').value = tip.id;
        document.getElementById('tipCategory').value = tip.category || '';
        document.getElementById('tipKeyword').value = tip.keyword;
        document.getElementById('tipContent').value = tip.content;
        
        document.getElementById('saveBtn').innerText = 'ìˆ˜ì • ì™„ë£Œ';
        window.scrollTo(0, 0);
    }

    function resetForm() {
        document.getElementById('tipId').value = '';
        document.getElementById('tipCategory').value = '';
        document.getElementById('tipKeyword').value = '';
        document.getElementById('tipContent').value = '';
        document.getElementById('saveBtn').innerText = 'ì €ì¥í•˜ê¸°';
    }

    async function saveTip() {
        const id = document.getElementById('tipId').value;
        const category = document.getElementById('tipCategory').value;
        const keyword = document.getElementById('tipKeyword').value;
        const content = document.getElementById('tipContent').value;

        if(!keyword || !content) return alert('í‚¤ì›Œë“œì™€ ë‚´ìš©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');

        const url = id ? `${API_URL}/tips/${id}` : `${API_URL}/tips`;
        const method = id ? 'PUT' : 'POST';

        await fetch(url, {
            method: method,
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ category, keyword, content })
        });

        resetForm();
        loadTips();
    }

    async function deleteTip(id) {
        if(!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        await fetch(`${API_URL}/tips/${id}`, { method: 'DELETE' });
        loadTips();
    }

    async function loadMaps() {
        const res = await fetch(`${API_URL}/maps`);
        const maps = await res.json();
        const tbody = document.getElementById('mapList');
        tbody.innerHTML = maps.map(map => `
            <tr>
                <td>${map.rotation_order}</td>
                <td>${map.name}</td>
                <td>:${map.emote}:</td>
            </tr>
        `).join('');
    }

    async function loadStats() {
        const res = await fetch(`${API_URL}/duel_stats`);
        const stats = await res.json();
        const tbody = document.getElementById('statsList');
        tbody.innerHTML = stats.map(s => `
            <tr>
                <td>${s.user_id}</td>
                <td>${s.wins}</td>
                <td>${s.losses}</td>
                <td>${s.draws}</td>
            </tr>
        `).join('');
    }

    // ì´ˆê¸° ë¡œë“œ
    loadTips();
</script>

</body>
</html>
